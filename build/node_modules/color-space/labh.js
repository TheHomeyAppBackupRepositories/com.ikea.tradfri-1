/**
 * Hunter-lab space.
 *
 * @module  color-space/labh
 */

'use strict';

const xyz = require('./xyz');

module.exports = {
  name: 'labh',

  // mins/maxes are taken from colormine
  // FIXME: check whether mins/maxes correct
  min: [0, -128, -128],
  max: [100, 128, 128],
  channel: ['lightness', 'a', 'b'],
  alias: ['LABh', 'hunter-lab', 'hlab'],

  // maths are taken from EasyRGB
  xyz(lab) {
    const l = lab[0]; const a = lab[1]; const
      b = lab[2];

    const _y = l / 10;
    const _x = a / 17.5 * l / 10;
    const _z = b / 7 * l / 10;

    const y = _y * _y;
    const x = (_x + y) / 1.02;
    const z = -(_z - y) / 0.847;

    return [x, y, z];
  },
};

// extend xyz
xyz.labh = function(xyz) {
  const x = xyz[0]; const y = xyz[1]; const
    z = xyz[2];
  const l = 10 * Math.sqrt(y);
  const a = y === 0 ? 0 : 17.5 * (((1.02 * x) - y) / Math.sqrt(y));
  const b = y === 0 ? 0 : 7 * ((y - (0.847 * z)) / Math.sqrt(y));

  return [l, a, b];
};
