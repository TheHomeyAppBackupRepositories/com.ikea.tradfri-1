/**
 * Cylindrical LAB
 *
 * @module color-space/lchab
 */

'use strict';

const xyz = require('./xyz');
const lab = require('./lab');


// cylindrical lab
var lchab = module.exports = {
  name: 'lchab',
  min: [0, 0, 0],
  max: [100, 100, 360],
  channel: ['lightness', 'chroma', 'hue'],
  alias: ['LCHab', 'cielch', 'LCH', 'HLC', 'LSH'],

  xyz(arg) {
    return lab.xyz(lchab.lab(arg));
  },

  lab(lch) {
    const l = lch[0];
    const c = lch[1];
    const h = lch[2];
    let a; let b; let
      hr;

    hr = h / 360 * 2 * Math.PI;
    a = c * Math.cos(hr);
    b = c * Math.sin(hr);
    return [l, a, b];
  },
};


// extend lab
lab.lchab = function(lab) {
  const l = lab[0];
  const a = lab[1];
  const b = lab[2];
  let hr; let h; let
    c;

  hr = Math.atan2(b, a);
  h = hr * 360 / 2 / Math.PI;
  if (h < 0) {
    h += 360;
  }
  c = Math.sqrt(a * a + b * b);
  return [l, c, h];
};

xyz.lchab = function(arg) {
  return lab.lchab(xyz.lab(arg));
};
